<!DOCTYPE html>
<html lang="en">
<head>
    <title>VR Scene</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidlab20/TFG@v0.7.0/docs/scripts/main.min.js"></script>
</head>
<script>
AFRAME.registerComponent('mode-manager', {
  init: function () {
    const camera = document.querySelector('#camera');
    const scene = this.el;
    const user = document.querySelector('#user');
    const environment = document.querySelector('[environment]');
    const chart = document.querySelector('#chart');

    scene.addEventListener('enter-vr', () => {

      if (scene.is('ar-mode')) {
        console.log("Modo AR");

        // Desactivar entorno
        if (environment) environment.setAttribute('visible', false);

        // Desactivar movimiento WASD
        if (user) user.removeAttribute('movement-controls');
        camera.removeAttribute('wasd-controls');

        // Colocar grÃ¡fico delante del usuario
        chart.setAttribute('position', {x: 0, y: -1.2, z: -2});
      }

      else {
        console.log("Modo VR");

        if (environment) environment.setAttribute('visible', true);
      }
    });

    scene.addEventListener('exit-vr', () => {
      console.log("Modo escritorio");
      camera.setAttribute('wasd-controls', 'acceleration: 35');
      chart.setAttribute('position', '0 2 -4');
      if (environment) environment.setAttribute('visible', true);
      if (user) user.setAttribute('movement-controls', 'speed: 0.1');
    });
  }
});
</script>

<body>
    <a-scene cursor="rayOrigin: mouse" raycaster="objects: [data-raycastable]" xr-mode-ui="enabled: true"
        webxr="requiredFeatures: local-floor; optionalFeatures: hit-test" mode-manager>
        <a-entity id="user" movement-controls="speed: 0.1">

            <!-- Camera -->
            <a-camera id="camera" position="0 1.6 0" active="true" wasd-controls="acceleration: 35"></a-camera>

            <!-- VR controllers -->
            <a-entity id="right-hand" laser-controls="hand: right"
                raycaster="objects: [data-raycastable]"
                line="color: yellow; opacity: 0.8">
            </a-entity>

            <a-entity id="left-hand" laser-controls="hand: left"
                raycaster="objects: [data-raycastable]"
                line="color: yellow; opacity: 0.8">
            </a-entity>
        </a-entity>

        <!-- HUD -->
        <a-entity id="HUD" position="0 0 0" visible="false">
            <a-plane height="1" width="2" shader="flat" color="grey"></a-plane>
            <a-text id="HUD-text" value="" align="center"></a-text>
        </a-entity>

        <!-- Environment -->
        <a-entity environment="preset: default"></a-entity>

        <!-- Elements -->
        <a-entity id="chart" position="0.0 2.0 -4.0" rotation="0.0 0.0 0.0">  <!-- Chart's box (modify this values if you want to change position or rotation) -->
			<a-entity position="-2.5 -2.0 1.0">
				<a-sphere info="leon : 10" position="0.5 2.0 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="ibiza : 15" position="0.9444 2.75 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="cordoba : 3" position="1.3889 0.95 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="toledo : 18" position="1.8333 3.2 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="altea : 4" position="2.2778 1.1 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="arosa : 12" position="2.7222 2.3 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="alhambra : 5" position="3.1667 1.25 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="600 : 20" position="3.6111 3.5 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="127 : 2" position="4.0556 0.8 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>
				<a-sphere info="panda : 13" position="4.5 2.45 -1.0" radius="0.5" color="blue" data-raycastable></a-sphere>

				<!-- X-axis -->
				<a-entity line="start: 0 0 0; end: 5.0 0 0; color: black"></a-entity>
				<a-text position="0.5 0.01 0.5" rotation="-90 0 -90" value="leon" align="left"></a-text>
				<a-text position="0.9444 0.01 0.5" rotation="-90 0 -90" value="ibiza" align="left"></a-text>
				<a-text position="1.3889 0.01 0.5" rotation="-90 0 -90" value="cordoba" align="left"></a-text>
				<a-text position="1.8333 0.01 0.5" rotation="-90 0 -90" value="toledo" align="left"></a-text>
				<a-text position="2.2778 0.01 0.5" rotation="-90 0 -90" value="altea" align="left"></a-text>
				<a-text position="2.7222 0.01 0.5" rotation="-90 0 -90" value="arosa" align="left"></a-text>
				<a-text position="3.1667 0.01 0.5" rotation="-90 0 -90" value="alhambra" align="left"></a-text>
				<a-text position="3.6111 0.01 0.5" rotation="-90 0 -90" value="600" align="left"></a-text>
				<a-text position="4.0556 0.01 0.5" rotation="-90 0 -90" value="127" align="left"></a-text>
				<a-text position="4.5 0.01 0.5" rotation="-90 0 -90" value="panda" align="left"></a-text>

				<!-- Y-axis -->
				<a-entity line="start: 0 0 0; end: 0 4 0; color: black"></a-entity>
				<a-text position="-0.5 0.25 0" rotation="0 0 0" value="0.0" align="right"></a-text>
				<a-text position="-0.5 1.1875 0" rotation="0 0 0" value="5.0" align="right"></a-text>
				<a-text position="-0.5 2.125 0" rotation="0 0 0" value="10.0" align="right"></a-text>
				<a-text position="-0.5 3.0625 0" rotation="0 0 0" value="15.0" align="right"></a-text>
				<a-text position="-0.5 4.0 0" rotation="0 0 0" value="20.0" align="right"></a-text>
			</a-entity>
		</a-entity>
    </a-scene>
</body>
</html>